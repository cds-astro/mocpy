<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MOCPy introduction &#8212; MOCPy 0.13.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/mocpy.css?v=b2680190" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
    
    <script src="../../_static/documentation_options.js?v=b4617fb1"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="icon" href="../../_static/MOCpy-icon.svg"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Compute the borders of a MOC" href="compute_moc_borders.html" />
    <link rel="prev" title="User documentation" href="../../examples/user_documentation.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../index.html"><span id="logotext1">MOC</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="compute_moc_borders.html" title="Compute the borders of a MOC">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="../../examples/user_documentation.html" title="User documentation">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../index.html">MOCPy 0.13.1 documentation</a>
	 &#187;
      </li>
      <li><a href="../../examples/user_documentation.html" accesskey="U">User documentation</a> &#187;</li>
      
      <li>MOCPy introduction</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="MOCPy-introduction">
<h1>MOCPy introduction<a class="headerlink" href="#MOCPy-introduction" title="Link to this heading">¶</a></h1>
<p>MOCPy is a python library for creating, manipulate and parse MOCs (Multi-Order Coverage maps). A MOC describes any arbitrary region on the sky. MOCs can be used to:</p>
<ul class="simple">
<li><p>Represent the spatial footprint of a catalog (source and/or image survey).</p></li>
<li><p>Compare the footprints, perform fast intersections, unions, differences.</p></li>
<li><p>Filter an astropy table by discarding all the sources that do not lie in the MOC region.</p></li>
</ul>
<p>MOCPy’s code can be found on GitHub: <a class="reference external" href="https://github.com/cds-astro/mocpy">https://github.com/cds-astro/mocpy</a> You can install it: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">mocpy</span></code></p>
<p>MOCPy’s documentation: <a class="reference external" href="https://cds-astro.github.io/mocpy/">https://cds-astro.github.io/mocpy/</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import astropy.units as u
import matplotlib.pyplot as plt
import mocpy
from astropy.coordinates import Angle, SkyCoord
from astropy.visualization.wcsaxes.frame import EllipticalFrame
from astroquery.cds import cds
from astroquery.simbad import Simbad
from astroquery.vizier import Vizier
from ipyaladin import Aladin
from ipywidgets import Box, Layout, widgets
from matplotlib import patheffects
from mocpy import WCS
from regions import CircleSkyRegion

mocpy.__version__
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;0.13.0&#39;
</pre></div></div>
</div>
</section>
<section id="##-Use-astroquery.cds-to-get-spatial-footprints-(MOCs)">
<h1>## Use astroquery.cds to get spatial footprints (MOCs)<a class="headerlink" href="###-Use-astroquery.cds-to-get-spatial-footprints-(MOCs)" title="Link to this heading">¶</a></h1>
<p>MOCs can be retrieved from <code class="docutils literal notranslate"><span class="pre">astroquery.cds</span></code>. <code class="docutils literal notranslate"><span class="pre">astroquery.cds</span></code> offers a Python access API to the MOCServer that stores ~20000 metadata and MOCs of Vizier catalogues and ~500 metadata and MOCs of HiPS image surveys.</p>
<p><code class="docutils literal notranslate"><span class="pre">astroquery.cds</span></code> documentation <a class="reference external" href="https://astroquery.readthedocs.io/en/latest/cds/cds.html#getting-started">https://astroquery.readthedocs.io/en/latest/cds/cds.html#getting-started</a></p>
<hr class="docutils" />
<p>Let’s retrieve:</p>
<ul class="simple">
<li><p>The MOC representing the footprint of all the HST combined surveys (see the astroquery.cds documentation, an example is given about that) at the order 8 (i.e. the precision of the MOC, ~13 arcmin)</p></li>
<li><p>The MOC representing the footprint of SDSS9: ID=’CDS/P/SDSS9/color’</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># HST MOC footprint
# -----------------
# We want to retrieve all the HST surveys i.e. the HST surveys covering any region of the sky.
allsky = CircleSkyRegion(SkyCoord(0, 0, unit=&quot;deg&quot;), Angle(180, unit=&quot;deg&quot;))
hst_moc = cds.query_region(
    region=allsky,
    # We want a MOCpy object instead of an astropy table
    return_moc=True,
    # The order of the MOC
    max_norder=11,
    # Expression on the ID meta-data
    meta_data=&quot;ID=*HST*&quot;,
)

# SDSS9
# -----
sdss_moc = cds.find_datasets(meta_data=&quot;ID=CDS/P/SDSS9/color&quot;, return_moc=True)

# GALEX
# -----
# galex = cds.find_datasets(meta_data=&quot;ID=CDS/P/GALEXGR6/AIS/color&quot;, return_moc=True)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>type(sdss_moc)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
mocpy.moc.moc.MOC
</pre></div></div>
</div>
</section>
<section id="##-Manipulate-MOCs-using-MOCPy">
<h1>## Manipulate MOCs using MOCPy<a class="headerlink" href="###-Manipulate-MOCs-using-MOCPy" title="Link to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">astroquery.cds</span></code> returns mocpy.MOC typed objects. Use MOCPy (see the API of the mocpy.MOC class <a class="reference external" href="https://cds-astro.github.io/mocpy/stubs/mocpy.MOC.html#mocpy.MOC">https://cds-astro.github.io/mocpy/stubs/mocpy.MOC.html#mocpy.MOC</a>) to manipulate them, for example you could:</p>
<ul class="simple">
<li><p>Compute their intersection/union</p></li>
<li><p>Serialize them to FITS/json, save them to FITS files</p></li>
<li><p>Filter an astropy table to keep only the sources being on a MOC (the intersection between sdss and the hst surveys).</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%%time
sdss_and_hst_moc = sdss_moc.intersection(hst_moc)
sdss_moc.serialize(format=&quot;fits&quot;)
sdss_moc.save(&quot;sdss_moc.fits&quot;, format=&quot;fits&quot;, overwrite=True)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 6.07 ms, sys: 8.07 ms, total: 14.1 ms
Wall time: 13.4 ms
</pre></div></div>
</div>
</section>
<section id="##-Plot-a-MOC-using-matplotlib">
<h1>## Plot a MOC using matplotlib<a class="headerlink" href="###-Plot-a-MOC-using-matplotlib" title="Link to this heading">¶</a></h1>
<p>Let’s see how to plot a MOC using matplotlib. There is an example of that on the MOCPy’s documentation: <a class="reference external" href="https://cds-astro.github.io/mocpy/examples/examples.html#loading-and-plotting-the-moc-of-sdss">https://cds-astro.github.io/mocpy/examples/examples.html#loading-and-plotting-the-moc-of-sdss</a></p>
<hr class="docutils" />
<p>We use <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> and<code class="docutils literal notranslate"><span class="pre">MOCPy</span></code> to draw the MOCs of HST and SDSS that we downloaded from <code class="docutils literal notranslate"><span class="pre">astroquery.cds</span></code>.</p>
<p>MOCPy offers an interface to create a WCS:</p>
<ul class="simple">
<li><p>centered around a SkyCoord position</p></li>
<li><p>with a specific field of view</p></li>
<li><p>and a projection (follows this link to see all the projection supported : <a class="reference external" href="https://docs.astropy.org/en/stable/wcs/#supported-projections">https://docs.astropy.org/en/stable/wcs/#supported-projections</a>)</p></li>
</ul>
<p>MOCPy offers 2 methods taking a <code class="docutils literal notranslate"><span class="pre">matplotlib.axe.Axe</span></code> and drawing into it either:</p>
<ul class="simple">
<li><p>the full area of the MOC (<code class="docutils literal notranslate"><span class="pre">mocpy.MOC.fill</span></code>)</p></li>
<li><p>only its perimeter (<code class="docutils literal notranslate"><span class="pre">mocpy.MOC.border</span></code>)</p></li>
</ul>
<p>These methods accept additional stylistic kwargs defined by <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>: <a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.patches.PathPatch.html#matplotlib.patches.PathPatch">https://matplotlib.org/api/_as_gen/matplotlib.patches.PathPatch.html#matplotlib.patches.PathPatch</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig = plt.figure(figsize=(20, 10))

with WCS(
    fig,
    fov=160 * u.deg,
    center=SkyCoord(0, 0, unit=&quot;deg&quot;, frame=&quot;icrs&quot;),
    coordsys=&quot;icrs&quot;,
    rotation=Angle(0, u.degree),
    projection=&quot;AIT&quot;,
) as wcs:
    # Create a matplotlib axe and give it a astropy.wcs.WCS-like object
    ax = fig.add_subplot(1, 1, 1, projection=wcs, frame_class=EllipticalFrame)

    # Fill the SDSS MOC in red with an opacity of 70%
    sdss_moc.fill(
        ax=ax,
        wcs=wcs,
        edgecolor=&quot;r&quot;,
        facecolor=&quot;r&quot;,
        linewidth=0,
        fill=True,
        alpha=0.7,
        label=&quot;sdss9 footprint&quot;,
    )
    # Draw its perimeter in black
    sdss_moc.border(ax=ax, wcs=wcs, color=&quot;black&quot;, alpha=0.5)

    # Fill the HST surveys MOC in green with an opacity of 70%
    hst_moc.fill(
        ax=ax,
        wcs=wcs,
        edgecolor=&quot;g&quot;,
        facecolor=&quot;g&quot;,
        linewidth=0,
        fill=True,
        alpha=0.7,
        label=&quot;hst all surveys footprint&quot;,
    )
    # Draw its perimeter in black
    hst_moc.border(ax=ax, wcs=wcs, color=&quot;black&quot;, alpha=0.5)

    # Fill the intersection MOC in blue
    sdss_and_hst_moc.fill(
        ax=ax,
        wcs=wcs,
        edgecolor=&quot;b&quot;,
        facecolor=&quot;b&quot;,
        linewidth=0,
        fill=True,
        alpha=0.7,
        label=&quot;intersection&quot;,
    )
    # Draw its perimeter in black
    sdss_and_hst_moc.border(ax=ax, wcs=wcs, color=&quot;black&quot;, alpha=0.5)

# Usual matplotlib calls
plt.title(&quot;Using matplotlib to vizualize MOCs&quot;)
plt.xlabel(&quot;ra&quot;)
plt.ylabel(&quot;dec&quot;)
plt.legend()
plt.grid(color=&quot;black&quot;, linestyle=&quot;dotted&quot;)
path_effects = [patheffects.withStroke(linewidth=3, foreground=&quot;black&quot;)]
ax.coords[0].set_ticklabel(color=&quot;white&quot;, path_effects=path_effects)
plt.show()
plt.close()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_collections_notebooks_00-MOCpy_introduction_11_0.png" src="../../_images/_collections_notebooks_00-MOCpy_introduction_11_0.png" />
</div>
</div>
</section>
<section id="##-Filter-an-astropy.Table-by-a-MOC">
<h1>## Filter an astropy.Table by a MOC<a class="headerlink" href="###-Filter-an-astropy.Table-by-a-MOC" title="Link to this heading">¶</a></h1>
<ol class="arabic simple">
<li><p>Retrieve a catalog table from Vizier (e.g. II/50). Add the columns ‘_RAJ2000’ and ‘_DEJ2000’ to the outputs. MOCPy needs the positions for filtering the table.</p></li>
<li><p>Filter the table to get only the sources that lie into intersection MOC.</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>viz = Vizier(columns=[&quot;*&quot;, &quot;_RAJ2000&quot;, &quot;_DEJ2000&quot;])
viz.ROW_LIMIT = -1
# Photometric standard stars (tables II and IV of paper)
tables = viz.get_catalogs(&quot;II/50&quot;)
tables
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>table = tables[0]
table
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>idx_inside = sdss_and_hst_moc.contains_lonlat(
    table[&quot;_RAJ2000&quot;].T * u.deg,
    table[&quot;_DEJ2000&quot;].T * u.deg,
)
sources_inside = table[idx_inside]
sources_inside
</pre></div>
</div>
</div>
</section>
<section id="##-Run-Aladin-Lite-inside-a-jupyter-notebook:-ipyaladin">
<h1>## Run Aladin-Lite inside a jupyter notebook: ipyaladin<a class="headerlink" href="###-Run-Aladin-Lite-inside-a-jupyter-notebook:-ipyaladin" title="Link to this heading">¶</a></h1>
<p>Aladin-Lite can be embedded into a jupyter notebook: Follow the readme on GitHub for installing it: <a class="reference external" href="https://github.com/cds-astro/ipyaladin">https://github.com/cds-astro/ipyaladin</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>aladin = Aladin()
aladin
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>aladin.target = &quot;messier 51&quot;
aladin.fov = 1
aladin.height = 600
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>aladin.coo_frame = &quot;icrs&quot;
</pre></div>
</div>
</div>
<p>Change the image survey, go to <a class="reference external" href="https://aladin.unistra.fr/hips/list">https://aladin.unistra.fr/hips/list</a> (Part 1. HiPS sky maps) to test with different image surveys! A list of good HiPS I like for testing: - P/2MASS/color - P/PanSTARRS/DR1/color-z-zg-g - P/SPITZER/color - P/SDSS9/color - P/GALEXGR6/AIS/color - P/Mellinger/color</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>aladin.survey = &quot;P/SDSS9/color&quot;
</pre></div>
</div>
</div>
<p>Add a MOC in the aladin-lite view!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># First use MOCPy to serialize our MOC into the JSON format
moc_serialized_json = sdss_and_hst_moc.serialize(&quot;json&quot;)
aladin.add_moc_from_dict(
    moc_serialized_json,
    {&quot;color&quot;: &quot;blue&quot;, &quot;opacity&quot;: 0.3, &quot;fill&quot;: True, &quot;edge&quot;: False, &quot;perimeter&quot;: True},
)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Add astropy source tables to the aladin lite viewer
aladin.add_table(sources_inside)
aladin.add_table(table[~idx_inside])
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># change the fov and target
aladin.target = &quot;13 04 4.193 -03 34 13.54&quot;
aladin.fov = 11
</pre></div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="Pass-Python-callback-functions-to-Javascript-event-listeners">
<h1>Pass Python callback functions to Javascript event listeners<a class="headerlink" href="#Pass-Python-callback-functions-to-Javascript-event-listeners" title="Link to this heading">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>aladin = Aladin(target=&quot;M 1&quot;, fov=0.2)
aladin
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>table = Simbad.query_region(&quot;M 1&quot;, radius=0.1 * u.deg)
aladin.add_table(table)
aladin.height = 600
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def get_ra_dec_data(source):
    &quot;&quot;&quot;Return the MainID, and coordinates of the clicked sources.&quot;&quot;&quot;
    return [source[&quot;data&quot;][&quot;MAIN_ID&quot;], source[&quot;ra&quot;], source[&quot;dec&quot;]]


def hover_source_callback(source):
    &quot;&quot;&quot;Return data corresponding to the hovered sources.&quot;&quot;&quot;
    return source[&quot;data&quot;]


# When trigerred, the listeners on the js side of the application will send a
# json object whose parameter data
# will be used by the python functions
# (data is a litteral object on the js side, it will be converted as a
# dictionary object on the Python side)
aladin.add_listener(&quot;objectHovered&quot;, hover_source_callback)
aladin.add_listener(&quot;objectClicked&quot;, get_ra_dec_data)
</pre></div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="Advanced-example">
<h1>Advanced example<a class="headerlink" href="#Advanced-example" title="Link to this heading">¶</a></h1>
<p>Create a rectangular selection using <code class="docutils literal notranslate"><span class="pre">ipywidgets</span></code> and gives back the selected sources to the user</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>aladin = Aladin(layout=Layout(width=&quot;70%&quot;), target=&quot;M 1&quot;, fov=0.2)

button = widgets.Button(description=&quot;Select&quot;)


def on_button_clicked(b):  # noqa: ARG001
    &quot;&quot;&quot;Trigger the rectangular selection tool.&quot;&quot;&quot;
    aladin.rectangular_selection()


button.on_click(on_button_clicked)
table_info = widgets.HTML(layout=Layout(height=&quot;auto&quot;, overflow=&quot;auto&quot;))

box_layout = Layout(
    display=&quot;flex&quot;,
    flex_flow=&quot;row&quot;,
    align_items=&quot;stretch&quot;,
    width=&quot;100%&quot;,
    overflow=&quot;hidden&quot;,
    height=&quot;100vh&quot;,
    margin=&quot;-100px 0 0 0&quot;,
    padding=&quot;100px 0 0 0 &quot;,
)
box = Box(children=[aladin, button, table_info], layout=box_layout)
box
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>table = Simbad.query_region(&quot;M 1&quot;, radius=0.1 * u.deg)
aladin.add_table(table)


def process_result(sources):
    &quot;&quot;&quot;Output an html table.&quot;&quot;&quot;
    s = &#39;&lt;table border=&quot;1&quot;&gt;&#39;
    s += &quot;&lt;tr&gt;&lt;th&gt;MAIN_ID&lt;/th&gt;&lt;th&gt;RA&lt;/th&gt;&lt;th&gt;DEC&lt;/th&gt;&lt;/tr&gt;&quot;
    for source in sources:
        s += &quot;&lt;tr&gt;&lt;td&gt;{}&lt;/td&gt;&lt;td&gt;{}&lt;/td&gt;&lt;td&gt;{}&lt;/td&gt;&lt;/tr&gt;&quot;.format(
            source[&quot;data&quot;][&quot;MAIN_ID&quot;],
            source[&quot;data&quot;][&quot;RA&quot;],
            source[&quot;data&quot;][&quot;DEC&quot;],
        )
    s += &quot;&lt;/table&gt;&quot;
    table_info.value = s


aladin.add_listener(&quot;select&quot;, process_result)
</pre></div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="Useful-links">
<h1>Useful links<a class="headerlink" href="#Useful-links" title="Link to this heading">¶</a></h1>
<p>More info about MOCs:</p>
<ul class="simple">
<li><p>It relies on the HEALPix tesselation of the sphere: paper link <a class="reference external" href="https://iopscience.iop.org/article/10.1086/427976/fulltext/">https://iopscience.iop.org/article/10.1086/427976/fulltext/</a></p></li>
<li><p>HEALPix implementation in the cdshealpix (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">cdshealpix</span></code>) <a class="reference external" href="https://github.com/cds-astro/cds-healpix-python">https://github.com/cds-astro/cds-healpix-python</a></p></li>
<li><p>The IVOA reference paper about MOC: <a class="reference external" href="http://ivoa.net/documents/MOC/20190903/PR-MOC-1.1-20190903.pdf">http://ivoa.net/documents/MOC/20190903/PR-MOC-1.1-20190903.pdf</a></p></li>
</ul>
<p>Time-MOCs and recently Space-Time MOCs:</p>
<ul class="simple">
<li><p>ADASS 2019 presentation from Pierre Fernique: <a class="reference external" href="https://www.adass2019.nl/wp-content/uploads/adass-oral/O2-3-fernique-stmoc-behind-the-scene.pdf">https://www.adass2019.nl/wp-content/uploads/adass-oral/O2-3-fernique-stmoc-behind-the-scene.pdf</a></p></li>
<li><p>IVOA notebook about ST-MOCs in MOCPy: <a class="reference external" href="https://github.com/cds-astro/mocpy/blob/master/notebooks/Space%20%26%20Time%20coverages.ipynb">https://github.com/cds-astro/mocpy/blob/master/notebooks/Space%20%26%20Time%20coverages.ipynb</a></p></li>
</ul>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script></section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">MOCPy introduction</a></li>
<li><a class="reference internal" href="###-Use-astroquery.cds-to-get-spatial-footprints-(MOCs)">## Use astroquery.cds to get spatial footprints (MOCs)</a></li>
<li><a class="reference internal" href="###-Manipulate-MOCs-using-MOCPy">## Manipulate MOCs using MOCPy</a></li>
<li><a class="reference internal" href="###-Plot-a-MOC-using-matplotlib">## Plot a MOC using matplotlib</a></li>
<li><a class="reference internal" href="###-Filter-an-astropy.Table-by-a-MOC">## Filter an astropy.Table by a MOC</a></li>
<li><a class="reference internal" href="###-Run-Aladin-Lite-inside-a-jupyter-notebook:-ipyaladin">## Run Aladin-Lite inside a jupyter notebook: ipyaladin</a></li>
<li><a class="reference internal" href="#Pass-Python-callback-functions-to-Javascript-event-listeners">Pass Python callback functions to Javascript event listeners</a></li>
<li><a class="reference internal" href="#Advanced-example">Advanced example</a></li>
<li><a class="reference internal" href="#Useful-links">Useful links</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="../../_sources/_collections/notebooks/00-MOCpy_introduction.ipynb.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2023, Matthieu Baumann &lt;matthieu.baumann@astro.unistra.fr&gt; Thomas Boch &lt;thomas.boch@astro.unistra.fr&gt; Manon Marchand &lt;manon.marchand@astro.unistra.fr&gt; F.-X. Pineau &lt;francois-xavier.pineau@astro.unistra.fr&gt;.<br/>
    Last built 04 Dec 2023. <br/>
  </p>
</footer>
  </body>
</html>